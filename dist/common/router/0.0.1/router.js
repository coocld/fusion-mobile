"use strict";define("common/router/router",function(){function n(){var n=i.getLocation(location.hash);i.isSameLocation(n,i.location)||(i.lastLocation=i.location,i.location=n,e[i.location.id].back&&i.lastLocation.id===e[i.location.id].back||!e[i.location.id].back&&i.lastLocation.id===t?(o[i.location.id]=e[i.location.id].backArgs=i.lastLocation.args,window.sessionStorage&&sessionStorage.setItem("routerHistory",JSON.stringify(o))):e[i.lastLocation.id].backArgs&&i.location.id===e[i.lastLocation.id].back&&(delete e[i.lastLocation.id].backArgs,delete o[i.lastLocation.id],window.sessionStorage&&sessionStorage.setItem("routerHistory",JSON.stringify(o))),"function"==typeof i.onchange&&i.onchange({type:"change"}))}var e,t,o,i={init:function(i,a){var r,c;if(!this.location){e=i,t=a,this.location=this.getLocation(location.hash),this.lastLocation={id:void 0,args:{}},o=window.sessionStorage?sessionStorage.getItem("routerHistory"):null,o=null===o?{}:JSON.parse(o);for(r in o)r in e&&(e[r].backArgs=o[r]);"onhashchange"in window?window.addEventListener("hashchange",n,!1):(c=location.hash,setInterval(function(){location.hash!==c&&(c=location.hash,n())},100))}},getLocation:function(n){var o,i,a={id:t,args:{}},r=n.match(/[^=&]+(=[^&]*)?/g);if(r){0===r[0].indexOf("#!")&&(i=r[0].substr(2),i in e&&(a.id=i));for(o=1;o<r.length;o++)i=r[o].match(/^([^=]+)(?:=(.+))?$/),i&&(a.args[i[1]]=i[2])}return a},buildHash:function(n){var e,t="#!"+n.id;for(e in n.args)t+=void 0===n.args[e]?"&"+e:"&"+e+"="+n.args[e];return t},getDefaultBack:function(n){var o,i,a,r;if(n||(n=this.location),i=e[n.id],i&&(i.back?r=i.back:n.id!==t&&(r=t),r&&e[r]))if(i.backArgs instanceof Object)a={id:r,args:i.backArgs};else if(a={id:r,args:{}},e[r].args)for(o=0;o<e[r].args.length;o++)e[r].args[o]in n.args&&(a.args[e[r].args[o]]=n.args[e[r].args[o]]);return a},isSameLocation:function(n,e){var t;if(n.id===e.id&&Object.keys(n.args).length===Object.keys(e.args).length){for(t in n.args)if(!(t in e.args)||n.args[t]!==e.args[t])return!1;return!0}return!1},isGoingback:function(n,o){if(o===t)return!0;for(;n!==t&&n!==o;)n=e[n].back||t;return n!==t}};return i});